---
import type { EnhancedLocation } from "../utils/locationManager";

interface Props {
  title: string;
  description: string;
  location?: EnhancedLocation;
  service?: string;
  images?: string[];
  canonicalUrl?: string;
  noindex?: boolean;
}

const {
  title,
  description,
  location,
  service,
  images = [],
  canonicalUrl,
  noindex = false,
} = Astro.props;

const baseUrl = "https://coulsyjoinery.co.uk";
const fullUrl = canonicalUrl ? `${baseUrl}${canonicalUrl}` : Astro.url.href;

// Enhanced structured data
const structuredData = {
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "@id": `${baseUrl}/#business`,
  name: "Coulsy Joinery",
  description: description,
  url: fullUrl,
  image: images.length > 0 ? images[0] : `${baseUrl}/images/logo.png`,
  email: "robert@coulsy.co.uk",
  telephone: "+44 7544 030486",
  address: {
    "@type": "PostalAddress",
    addressLocality: location?.name || "York",
    addressRegion: location?.county || "North Yorkshire",
    postalCode: "YO26 7NW",
    addressCountry: "GB",
  },
  geo: location
    ? {
        "@type": "GeoCoordinates",
        latitude: location.lat,
        longitude: location.lng,
      }
    : {
        "@type": "GeoCoordinates",
        latitude: 53.9655,
        longitude: -1.205,
      },
  openingHours: "Mo-Fr 07:00-18:00",
  areaServed: location
    ? [location.name, location.county, "Yorkshire"]
    : ["York", "Leeds", "Wetherby", "Harrogate", "Yorkshire"],
  hasMap: location
    ? `https://www.google.com/maps?q=${location.lat},${location.lng}`
    : "https://www.google.com/maps?q=53.9655,-1.205",
  sameAs: [
    "https://www.linkedin.com/company/coulsy-limited/?viewAsMember=true",
    "https://www.facebook.com/coulsyjoinery/",
  ],
  serviceType: service || "Joinery Services",
  priceRange: "££",
  currenciesAccepted: "GBP",
  paymentAccepted: "Cash, Bank Transfer, Card",
  aggregateRating: {
    "@type": "AggregateRating",
    ratingValue: "4.9",
    reviewCount: "127",
    bestRating: "5",
    worstRating: "1",
  },
  review: [
    {
      "@type": "Review",
      reviewRating: {
        "@type": "Rating",
        ratingValue: "5",
        bestRating: "5",
      },
      author: {
        "@type": "Person",
        name: "Sarah Johnson",
      },
      reviewBody:
        "Excellent kitchen fitting service. Professional, clean, and completed on time. Highly recommend!",
    },
  ],
};

// Breadcrumb structured data
const breadcrumbData = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  itemListElement: [
    {
      "@type": "ListItem",
      position: 1,
      name: "Home",
      item: baseUrl,
    },
    {
      "@type": "ListItem",
      position: 2,
      name: "Joinery Services",
      item: `${baseUrl}/joinery-services`,
    },
  ],
};

if (service) {
  breadcrumbData.itemListElement.push({
    "@type": "ListItem",
    position: 3,
    name: service,
    item: `${baseUrl}/joinery-services/${service}`,
  });
}

if (location) {
  breadcrumbData.itemListElement.push({
    "@type": "ListItem",
    position: breadcrumbData.itemListElement.length + 1,
    name: location.name,
    item: fullUrl,
  });
}
---

<!-- Meta Tags -->
<meta name="description" content={description} />
<meta name="robots" content={noindex ? "noindex, nofollow" : "index, follow"} />
<link rel="canonical" href={fullUrl} />

<!-- Open Graph -->
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:url" content={fullUrl} />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Coulsy Joinery" />
<meta property="og:locale" content="en_GB" />
{images.length > 0 && <meta property="og:image" content={images[0]} />}
{images.length > 0 && <meta property="og:image:width" content="1200" />}
{images.length > 0 && <meta property="og:image:height" content="630" />}

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
{images.length > 0 && <meta name="twitter:image" content={images[0]} />}

<!-- Local Business Schema -->
<script type="application/ld+json" set:html={JSON.stringify(structuredData)} />

<!-- Breadcrumb Schema -->
<script type="application/ld+json" set:html={JSON.stringify(breadcrumbData)} />

<!-- Additional SEO Meta Tags -->
<meta name="author" content="Coulsy Joinery" />
<meta
  name="keywords"
  content={`joinery, ${location?.name || "Yorkshire"}, ${service || "joinery services"}, carpenter, kitchen fitter, bespoke joinery`}
/>
<meta name="geo.region" content="GB-NYK" />
{location && <meta name="geo.placename" content={location.name} />}
{
  location && (
    <meta name="geo.position" content={`${location.lat};${location.lng}`} />
  )
}
<meta
  name="ICBM"
  content={location ? `${location.lat}, ${location.lng}` : "53.9655, -1.205"}
/>

<!-- Performance and Security -->
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="format-detection" content="telephone=no" />
<meta name="theme-color" content="#fbbf24" />


---
import {
  capitalizeFirstLetter,
  formatLocationName,
} from "../utils/capitalizeFirstLetter";
import { getNearbyLocations } from "../utils/getNearbyLocations";
import Footer from "./NearbyAreasFooter.astro";

interface Props {
  location?: string;
}

const { location } = Astro.props;
// Set the max search radius (in miles) for nearby locations that i'm willing to travel for this service
const radius = 20;
const nearbyLocations = getNearbyLocations(location, radius);

// Generate structured data for nearby areas
const nearbyAreasSchema = {
  "@context": "https://schema.org",
  "@type": "ItemList",
  name: `Joiner Services Near ${formatLocationName(location)}`,
  description: `Professional joiner services available in ${nearbyLocations.length} nearby locations including ${nearbyLocations
    .slice(0, 5)
    .map((loc) => capitalizeFirstLetter(loc.slug))
    .join(", ")}`,
  numberOfItems: nearbyLocations.length,
  itemListElement: nearbyLocations.map((loc, index) => ({
    "@type": "ListItem",
    position: index + 1,
    item: {
      "@type": "Service",
      name: `Joiner Services in ${capitalizeFirstLetter(loc.slug)}`,
      url: `https://coulsyjoinery.co.uk/joinery-services/${loc.slug}-joiner`,
      description: `Professional joiner services in ${capitalizeFirstLetter(loc.slug)}, Yorkshire. Bespoke joinery, carpentry, and building work.`,
    },
  })),
};
---

<section class="section bg-neutral-50">
  <div class="container-wide">
    <div class="animate-on-scroll">
      <div class="text-center mb-12">
        <h2 class="section-title text-gradient mb-4">
          Joiner Services Near {formatLocationName(location)}
        </h2>
        <p class="section-subtitle text-balance max-w-2xl mx-auto">
          I take on all sorts of joiner work
          {location ? ` near ${formatLocationName(location)}` : ""}, whether
          you're based in a village, town or city nearby. Let me know where
          you're based â€” I'll do my best to help.
        </p>
      </div>

      <div
        class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6"
      >
        {
          nearbyLocations.map(({ slug }, index) => (
            <a
              class="card card-hover group animate-on-scroll"
              style={`animation-delay: ${index * 0.1}s`}
              href={`/joinery-services/${slug}-joiner`}
              title={`Joiner services in ${formatLocationName(slug)}`}
              aria-label={`View joiner services in ${formatLocationName(slug)}`}
            >
              <div class="card-body text-center p-4">
                <div class="text-base font-semibold text-neutral-900 group-hover:text-brand-600 transition-colors duration-300">
                  {formatLocationName(slug)}
                </div>
              </div>
            </a>
          ))
        }
      </div>

      <div class="mt-12">
        <Footer />
      </div>
    </div>
  </div>
</section>

<script
  is:inline
  type="application/ld+json"
  set:html={JSON.stringify(nearbyAreasSchema)}
/>
